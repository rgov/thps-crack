# Metal-Accelerated Cheat Code Cracker for *Tony Hawk's Pro Skater 2/3*

Bo Bayles [reverse-engineered *Tony Hawk's Pro Skater 2*][bbayles] to understand how the game recognizes cheat codes on PlayStation and Dreamcast consoles.

[bbayles]: https://32bits.substack.com/p/under-the-microscope-tony-hawks-pro

In brief, while the game is paused and the player is holding down <kbd>L1</kbd>, each additional button press updates two 32-bit hashes. If the hashes match one of the expected values for the cheat codes, the game activates the corresponding cheat.

For example, in *Tony Hawk's Pro Skater 2*, to enable "mirror mode", the hashes must equal `0xA3E2DCE2` and `0x7A6115CE` respectively. These values are generated by the button sequence <kbd>↑ ↓ ← → Y A X B ↑ ↓ ← → Y A X B</kbd> on Dreamcast.

Bo discovered hash values for several previously-unknown cheat codes in *Tony Hawk's Pro Skater 2* and *3*. The challenge is figuring out what button combinations would generate these specific hash values.

This repo contains a GPU-accelerated brute force program to try to uncover the remaining codes. The program uses Apple's Metal API and can be run on a macOS device:

    $ make
    $ time ./thpscrack 1 10 1 2 A3E2DCE2 7A6115CE
    ...
    Found solution: UDLRTXSCUDLRTXSC
    Target hashes: 0xA3E2DCE2 0x7A6115CE

The arguments are *minimum length*, *maximum length*, *minimum repetitions*, *maximum repetitions*. Repetitions are a way to quickly try longer button sequences from repeated subsequences (as above). The output uses PlayStation nomenclature, <kbd>T</kbd> = Triangle and so on.

On a MacBook Pro with M1 Max it can search through 13-button sequences (that's 8^13 = 549.8  billion) in about 46 seconds.

The code was written through a back and forth with Claude 3.5 Sonnet.


### Future enhancement

We could save effort by calculating the first hash and then, only if it matches, calculating the second one.

Repetitions should be processed on the GPU by running the hash-and-check procedure in a loop, rather than having the CPU submit more workloads.
